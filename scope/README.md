# 스코프

## 스코프
- 변수가 영향을 미치는 범위
- 선언시 스코프가 결정 (호출이 아님)

## 스코프 체인
- 자신의 상위 스코프를 참조하는 매커니즘
- 상위의 상위의... 스코프를 체인처럼 꼬리를 물고 있는 형태

## 함수형 / 블록 스코프

### 함수형 스코프
- 함수 내에 선언된 변수가 영향을 미치는 범위
- var로 선언된 변수는 함수 스코프를 갖는다.

### 블록 스코프
- 블록내에 선언된 변수가 영향을 미치는 범위
- let, const 블록 스코프를 갖는다.

### 렉시컬 스코프
- 렉시컬 스코프는 함수를 어디서 호출하는지가 아니라 어디에 선언하였는지에 따라 결정된다.
- 자바스크립트는 렉시컬 스코프를 따르므로 함수를 선언한 시점에 상위 스코프가 결정된다.
- 함수를 어디에서 호출하였는지는 스코프 결정에 아무런 의미를 주지 않는다.

## 함수
### 선언형
    ```
        function square(number) {
            return number * number;
        }
    ```
### 표현식
    ```
        const square = function(number) {
            return number * number;
        }
    ```

## 호이스팅
- 변수 및 함수의 선언을 최상단으로 올리는 것 (var로 선언된 경우)
- 변수 값 할당 및 초기화의 경우 코드의 위치에서 그래도 실행됨
- 실행 컨텍스트 때문에 호이스팅이 발생함
    - 변수선언
    - 변수 초기화
    - 변수에 사용자가 지정한 값으로 초기화
        - 해당 실행 컨텍스트의 변수 객체 생성이 완료된 뒤에 발생함
    - 함수 선언문인지 표현식인지에 따라 생성 과정이 나뉨
        - 선언문
            - 함수선언,초기화,사용자 지정값으로 초기화 모두 발생함
        - 표현식
            - 익명함수를 생성하여 변수에 할당하는 식이기 때문에 변수 호이스팅이 발생
            - 사용자가 지정한 값으로 초기화를 거치지 않고 호출되는 경우 에러 발생

## 실행 컨텍스트
    - 자바스크립트 엔진이 코드를 실행하기 위해 필요한 정보
        - 변수
        - 함수선언
        - 변수의 유효범위 (스코프)
        - this
    - 컨텍스트
        - 전역 컨텍스트
            - 특정 함수안에서 실행되는 코드가 아니라면 전역 컨텍스트에서 실행됨
            - window(전역컨텍스트) 생성
            - this = window로 할당함
        - 함수 컨텍스트
            - 함수는 자신만의 실행컨텍스트를 갖는다.
            - 함수가 호출되어야지만 생성됨

## 클로저
- 외부 환경을 기억하고 있는 함수
- 생성된 함수는 scopes프로퍼티를 갖고 있기때문에 외부 함수가 소멸하여도 scopes 프로퍼티가 가리키는 외부함수의 실행환경을 기억할수있다.
![context_example](./image/context_example.png)

## let
- ES6에 추가됨
- 선언후 재할당이 가능함

## const
- 선언시 할당이 진행되어야함

## Temporal Dead Zone
- let, const로 선언된 변수들에 접근시 에러가 발생함
- Scope에 들어간 시점과 변수에 선언된 시점 사이에 접근할 수 없는 주기


# 실행컨텍스트
- 실행가능한 코드에 대한 추상적인 개념

| `실행컨텍스트` | 
|:---|
`Variable Object`|
`Scope Chain`|
`thisValue`|


VO는 아래의 정보를 갖는다.
| `Variable Object (VO / 변수객체)` | 
|:---|
`변수`|
`매개변수(Parameter) & 인자(Arguments)`|
`함수선언(표현식은 제외)`|

VO의 경우 전역 컨텍스트와 함수 컨텍스트의 경우 동작이 조금 다르다.
- 전역 컨텍스트
    - VO는 유일한 최상위에 위치
    - 모든 전역변수, 전역 함수등을 포함하는 전역 객체를 가리킨다.
- 함수 컨텍스트
    - VO는 AO(Activate Object / 활성객체)를 가리킨다.
    - 매개변수와 인자의 정보를 배열에 담고 있는 객체인 arguments object가 추가됨


## 스코프체인
- 해당 전역 또는 함수가 참조할 수 있는 변수, 함수선언등의 정보를 담고 있는 전역, 활성 객체의 리스트를 가리킨다.
- 변수를 검색하는 매커니즘
- 함수실행중에 변수를 만나면 현재 Scope 즉, 활성객체를 검색함
- 검색이 실패하면 스코프체인에 담겨진 순서대로 검색을 실행
- [[SCOPE]] 프로퍼티를 통해 스코프 체인을 참조할수 있음

## this
호출 패턴에 따라 this값이 변경됨
